"use strict";

var assert = require('assert');

var b2boptic_lensorder = require('../index.js');

var xmlValid = '<?xml version="1.0" encoding="utf-8"?><b2bOptic xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="b2boptic_v1.6.2.xsd"><header><customersOrderId /><distributorsOrderId /><timeStamps><dateTime step="CREATE">2017-09-28T11:04:27.184+02:00</dateTime></timeStamps><orderParties role="ORIGINATOR"><id /></orderParties><software typeOf="ORIGINATOR"><name>Rodenstock Consulting</name><version>4.115.0.0</version></software><portalOrderId /></header><items><item><referenceNo>Peter Testmeier</referenceNo><referenceText>Testmeier,Peter</referenceText><manufacturer>Rodenstock GmbH</manufacturer><pair><patient><id>8b390e43-6d09-431e-8e10-8588557c5e32</id><name>Peter Testmeier</name><address /><contact><firstName>Peter</firstName><lastName>Testmeier</lastName></contact><gender>FEMALE</gender><interpupillaryDistanceRight>32</interpupillaryDistanceRight><interpupillaryDistanceLeft>32</interpupillaryDistanceLeft><backVertexDistanceRefractionRight>13</backVertexDistanceRefractionRight><backVertexDistanceRefractionLeft>13</backVertexDistanceRefractionLeft><pupillometryData><identification><id>00000000-0000-0000-0000-000000000000</id><timeStamp>0001-01-01T00:00:00</timeStamp><device><deviceId>IMPRESSIONIST4</deviceId><softwareVersion>1.0</softwareVersion></device></identification><pupilData condition="PHOTOPIC" side="RIGHT" illuminance="789"><pupilDiameter>2</pupilDiameter></pupilData><pupilData condition="PHOTOPIC" side="LEFT" illuminance="789"><pupilDiameter>3.79993176</pupilDiameter></pupilData></pupillometryData></patient><lens side="RIGHT" quantity="1"><commercialCode>I2LK</commercialCode><rxData><sphere>2</sphere><cylinder><power>2</power><axis>2</axis></cylinder><addition>2</addition></rxData><centration><monocularCentrationDistance reference="FAR">32</monocularCentrationDistance><height reference="FAR" referenceHeight="OVERBOX">22</height><backVertexDistance rxDataNeedRecalculation="false">13</backVertexDistance></centration><geometry><diameter><physical>0</physical><optical>0</optical></diameter><inset>2.5</inset></geometry></lens><lens side="LEFT" quantity="1"><commercialCode>I2LK</commercialCode><rxData><sphere>2</sphere><cylinder><power>2</power><axis>2</axis></cylinder><addition>2</addition></rxData><centration><monocularCentrationDistance reference="FAR">32</monocularCentrationDistance><height reference="FAR" referenceHeight="OVERBOX">22</height><backVertexDistance rxDataNeedRecalculation="false">13</backVertexDistance></centration><geometry><diameter><physical>0</physical><optical>0</optical></diameter><inset>2.5</inset></geometry></lens><frame quantity="1"><material>METAL</material><model /><shape><tracerData><tracerType>Unknown</tracerType><tracerVersion /><binaries format="NIDEK">4601F02D29F109D50B0D0C0C0B0B0908060401FEFCF8F3F0EBE7E3DF06DBD906D6D407D1D007CF07CD08CD07CC0808CC08CD08CD0808CE0908D008D10909D10909D108090ACF090ACF090909CF090909CE09090ACC0A09090ACC09090A09CB090A0909CB0909090A09CA090909090A09C90909090909CA09080909090809CA08090809080909CA0808080908080808CC0808070808080708CE080707080707070708D107070607070607070607D507060606060606060606DB0605060505050605050505E20505040505040405040404EB040403040403040303040303F4030303030203020203020202FF0202020102010201010101010B010001000100010000000000150000FFFF00FFFFFFFFFFFF20FFFEFFFEFFFEFEFEFEFEFE29FEFDFEFDFDFDFEFDFCFD32FDFCFDFCFCFCFDFCFCFC38FCFBFCFBFBFCFBFBFB3EFAFBFBFAFAFBFAFAFA42FAFAF9FAFAF9F945F9F9F9F9F9F9F847F9F8F8F8F8F8F848F7F8F7F8F7F847F7F7F7F7F747F7F6F6F7F647F6F5F6F646F5F6F5F545F5F4F5F545F4F5F446F4F4F447F4F3F447F3F4F347F3F3F346F2F345F2F343F2F341F240F2F23DF23AF238F135F032F02EF129F12520F11C1712F10E0B0805F00300FEFCFBFAF2FAF9F9F9FAFAFCF3FDFEFDFDFDFCFDF5FCFCFCFCFCFBFBF7FBFBFBFBFBFAFAFAFBF9FBFBFBFBFBFBFCFBFAFBFAF9F9FEF8F8F7F7F5F5FFF4F4F3F301F2F2F202F1F102F0F003EFEF04EEED04EDEB05EB06EAE906E707E607E507E308E208E108E008E00809DE09DE0909DD090ADC0A09DD090ADC0A0ADC0A0BDB0B0ADC0A0B0ADC0B0B0ADD0A0BDD0B0B0BDD0A0B0B0BDC0B0B0BDC0A0B0B0BDB0B0B0B0BDB0B0B0A0BDB0B0A0B0B0BDA0B0B0A0BDB0A0B0A0B0A0ADC0A0A0A0B0ADC0A0A0A0A0A09DE090A090A090ADF09090909090AE0090908090908E3080908080808E608070808070807E808070707070707EB06070607060607EE06060506060506F1060505050504F604050404050404F804040304030304FC0302030302030200020202020102030101020101010006010001000000090000FF00FF00FF0CFFFFFFFEFFFE0FFEFFFEFDFEFE12FDFEFDFDFDFD15FCFDFCFDFCFC17FCFCFCFBFC19FBFCFBFBFBFA1CFAFBFAFAFA1DFAFAFAFAF91FF9FAF9F9F920F9F8F9F822F8F8F8F8F823F7F8F7F823F7F8F7F724F7F6F7F626F6F6F7F626F6F6F628F5F5F6F528F5F5F529F5F4F529F4F5F429F4F4F428F4F4F328F3F427F3F326F3F3F324F3F223F3F221F31FF2F31DF21BF2F219F216F214F211F20FF20CF20AF209F207F20604F303F20302F301F30101F30101F40102F40203F50303F50303F50303F5030303F6030203F70303F8030403F8040504F9050506FA060706FB070807FC080808FC08080808FD0807070607090A00000000004E434E430000000029F10000000000000EBA00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</binaries></tracerData></shape><boxWidth>62.8</boxWidth><boxHeight>40.6</boxHeight><distanceBetweenLenses>15</distanceBetweenLenses><pantoscopicAngleRight>2.4</pantoscopicAngleRight><pantoscopicAngleLeft>2.36855578</pantoscopicAngleLeft><frameBowAngle>8</frameBowAngle></frame></pair></item></items></b2bOptic>';
var parseString = require('xml2js').parseString;
var jsonValidObject = null;
parseString(xmlValid, function(err,result){
  if(err) {
      throw err;
  }
  jsonValidObject = result;
});

var xmlTestString = b2boptic_lensorder.serialize(jsonValidObject);
var jsonTestObject = null;
parseString(xmlTestString, function(err,result){
  if(err) {
      throw err;
  }
  jsonTestObject = result;
});

describe('b2bOptic', function() {  
  it('Original and serialized objects should match', function() {
    assert.deepEqual(jsonValidObject, jsonTestObject);
  }); 
});